(* Content-type: application/vnd.wolfram.mathematica *)

(*** Wolfram Notebook File ***)
(* http://www.wolfram.com/nb *)

(* CreatedBy='Mathematica 10.2' *)

(*CacheID: 234*)
(* Internal cache information:
NotebookFileLineBreakTest
NotebookFileLineBreakTest
NotebookDataPosition[       158,          7]
NotebookDataLength[     47520,       1152]
NotebookOptionsPosition[     44707,       1055]
NotebookOutlinePosition[     45041,       1070]
CellTagsIndexPosition[     44998,       1067]
WindowFrame->Normal*)

(* Beginning of Notebook Content *)
Notebook[{

Cell[CellGroupData[{
Cell["Model Based EKF Equations of Motion", "Title",
 CellChangeTimes->{{3.664822022582201*^9, 3.664822030741487*^9}}],

Cell[CellGroupData[{

Cell["Setup", "Section",
 CellChangeTimes->{{3.664822034075942*^9, 3.6648220345714607`*^9}}],

Cell[BoxData[
 RowBox[{
  RowBox[{"projname", "=", "\"\<imu_common\>\""}], ";"}]], "Input",
 CellChangeTimes->{{3.665497599171884*^9, 3.6654976050541763`*^9}}],

Cell[CellGroupData[{

Cell[BoxData[{
 RowBox[{"SetDirectory", "[", 
  RowBox[{"NotebookDirectory", "[", "]"}], "]"}], "\[IndentingNewLine]", 
 RowBox[{"UtilsPath", "=", 
  RowBox[{"FileNameJoin", "[", 
   RowBox[{"{", 
    RowBox[{
     RowBox[{"NotebookDirectory", "[", "]"}], ",", "\"\<utils\>\""}], "}"}], 
   "]"}]}], "\n", 
 RowBox[{
  RowBox[{"$Path", "=", 
   RowBox[{"DeleteDuplicates", "[", 
    RowBox[{"Append", "[", 
     RowBox[{"$Path", ",", "UtilsPath"}], "]"}], "]"}]}], ";"}]}], "Input",
 CellChangeTimes->{{3.603297493708568*^9, 3.60329749427559*^9}, 
   3.606057010750979*^9, 3.608839514302059*^9, {3.611181451992013*^9, 
   3.611181596970031*^9}, {3.612147659239377*^9, 3.612147666732231*^9}, {
   3.6121568690929623`*^9, 3.612156887339925*^9}, {3.6121580233518553`*^9, 
   3.612158031317995*^9}, {3.6648254558904533`*^9, 3.664825497071765*^9}, {
   3.664825528816492*^9, 3.664825542794549*^9}, {3.664825586425667*^9, 
   3.664825588510503*^9}, {3.664825848191557*^9, 3.6648258487834787`*^9}, {
   3.664877062211335*^9, 3.664877062775502*^9}, {3.665444065620743*^9, 
   3.665444082270199*^9}, 3.665498908642894*^9, {3.665499529900916*^9, 
   3.665499530321107*^9}}],

Cell[BoxData["\<\"/home/jreher/test_ws/src/ros_imu/imu_common/mathematica\"\>\
"], "Output",
 CellChangeTimes->{
  3.6121476992091084`*^9, {3.612156869565259*^9, 3.612156887782346*^9}, {
   3.612157647204705*^9, 3.612157657983346*^9}, 3.612158032046053*^9, 
   3.612158188454749*^9, 3.61216539250436*^9, 3.612166176315783*^9, 
   3.612224999491642*^9, 3.612227914899782*^9, 3.6122284611347227`*^9, 
   3.612399454229295*^9, 3.612461726524466*^9, 3.612535987463235*^9, 
   3.612544688868466*^9, 3.6125673091337957`*^9, 3.612569508289462*^9, 
   3.612569559615514*^9, 3.6126145441052837`*^9, 3.6126269680488367`*^9, 
   3.612627026824563*^9, 3.612656302421338*^9, 3.6126715414904947`*^9, 
   3.6127043770482616`*^9, 3.612754588650343*^9, 3.612787453028413*^9, 
   3.612831262624928*^9, 3.612838377978693*^9, 3.612873386154606*^9, 
   3.6129542107389393`*^9, 3.6130092490503397`*^9, 3.6130644793377523`*^9, 
   3.613102419855217*^9, 3.6131035592042837`*^9, 3.6131039406049223`*^9, 
   3.613104267347789*^9, 3.61310958357122*^9, 3.6132289178032312`*^9, 
   3.6133544519700317`*^9, 3.6133959918507767`*^9, 3.613407341172435*^9, 
   3.613409983733012*^9, 3.613436251695031*^9, 3.613699032852221*^9, 
   3.6137000739572573`*^9, 3.613913329934135*^9, 3.6139211644432383`*^9, 
   3.614289776048626*^9, 3.615045382536487*^9, 3.6150867874611197`*^9, 
   3.615088730367077*^9, 3.615089069325182*^9, 3.615117796214798*^9, 
   3.61547705619781*^9, 3.615775443168846*^9, 3.6158384866818867`*^9, 
   3.6158522953849163`*^9, 3.616007737290127*^9, 3.617907086311778*^9, 
   3.617908814847932*^9, 3.617908882961569*^9, 3.617909858722218*^9, 
   3.619109477285598*^9, 3.6234205056396847`*^9, 3.623429491062416*^9, 
   3.6234305077233057`*^9, 3.623433482922448*^9, 3.623433572650155*^9, {
   3.623452253622682*^9, 3.623452292975308*^9}, 3.6234567519585114`*^9, 
   3.62345759720179*^9, 3.623457970903495*^9, 3.623510681837118*^9, 
   3.623605456673884*^9, 3.6247470446028757`*^9, 3.664825329005344*^9, 
   3.664825394758458*^9, {3.66482549579117*^9, 3.6648255065195923`*^9}, 
   3.6648255441401043`*^9, {3.664825588907996*^9, 3.66482561587079*^9}, 
   3.664825796757291*^9, {3.6648258640924807`*^9, 3.664825884173077*^9}, 
   3.664826187022998*^9, 3.664826511023731*^9, 3.664826688434367*^9, 
   3.664826823515493*^9, 3.6648269158324537`*^9, 3.664877019861074*^9, 
   3.664887395328328*^9, 3.6653583460476217`*^9, 3.665439697410212*^9, 
   3.6654434418350782`*^9, {3.6654440606075*^9, 3.665444082545102*^9}, 
   3.665444935762998*^9, 3.665445392480155*^9, 3.6654961947944593`*^9, 
   3.6654963834512672`*^9, 3.6654973598707848`*^9, {3.665497732576871*^9, 
   3.6654977443613577`*^9}, 3.665497953377412*^9, 3.665498908997188*^9, 
   3.665498950542206*^9, 3.665499002230302*^9, 3.665499266672222*^9, 
   3.665499535474121*^9, {3.665499568454471*^9, 3.665499582351803*^9}, 
   3.6654997886561537`*^9, 3.665500136215979*^9, {3.666015716931199*^9, 
   3.666015722904353*^9}, 3.666016187025942*^9, 3.666016249588983*^9, {
   3.66601632813623*^9, 3.666016336781468*^9}, 3.6660165616981573`*^9, {
   3.666016656308172*^9, 3.666016685299205*^9}, 3.666016728492584*^9, {
   3.666016792192339*^9, 3.666016837429551*^9}, 3.6660172647576923`*^9, 
   3.666017316131689*^9, 3.666017560219376*^9, 3.666017815107621*^9, {
   3.666018553077723*^9, 3.666018581643537*^9}, 3.666019783015769*^9, 
   3.666019835086779*^9, {3.666019922114092*^9, 3.666019934416548*^9}, 
   3.6660200071691713`*^9, {3.666020060627389*^9, 3.666020065381884*^9}, 
   3.666020119308031*^9, {3.666020152989551*^9, 3.66602017929902*^9}, 
   3.666020763253985*^9, {3.66602079975984*^9, 3.666020802920162*^9}, 
   3.666020874659059*^9, 3.6660209760920753`*^9, 3.6660210253193274`*^9, 
   3.666021298719104*^9, 3.666027394565832*^9, {3.666027451206373*^9, 
   3.666027457503265*^9}, 3.6660285131410027`*^9, 3.6660285644812*^9, {
   3.666028979644044*^9, 3.6660290212153*^9}, {3.666029099331403*^9, 
   3.666029117551256*^9}, {3.666029871695498*^9, 3.666029891258871*^9}, 
   3.666444703479611*^9, 3.666444847981908*^9, 3.66644488326353*^9, {
   3.666444966109524*^9, 3.66644497657889*^9}}],

Cell[BoxData["\<\"/home/jreher/test_ws/src/ros_imu/imu_common/mathematica/\
utils\"\>"], "Output",
 CellChangeTimes->{
  3.6121476992091084`*^9, {3.612156869565259*^9, 3.612156887782346*^9}, {
   3.612157647204705*^9, 3.612157657983346*^9}, 3.612158032046053*^9, 
   3.612158188454749*^9, 3.61216539250436*^9, 3.612166176315783*^9, 
   3.612224999491642*^9, 3.612227914899782*^9, 3.6122284611347227`*^9, 
   3.612399454229295*^9, 3.612461726524466*^9, 3.612535987463235*^9, 
   3.612544688868466*^9, 3.6125673091337957`*^9, 3.612569508289462*^9, 
   3.612569559615514*^9, 3.6126145441052837`*^9, 3.6126269680488367`*^9, 
   3.612627026824563*^9, 3.612656302421338*^9, 3.6126715414904947`*^9, 
   3.6127043770482616`*^9, 3.612754588650343*^9, 3.612787453028413*^9, 
   3.612831262624928*^9, 3.612838377978693*^9, 3.612873386154606*^9, 
   3.6129542107389393`*^9, 3.6130092490503397`*^9, 3.6130644793377523`*^9, 
   3.613102419855217*^9, 3.6131035592042837`*^9, 3.6131039406049223`*^9, 
   3.613104267347789*^9, 3.61310958357122*^9, 3.6132289178032312`*^9, 
   3.6133544519700317`*^9, 3.6133959918507767`*^9, 3.613407341172435*^9, 
   3.613409983733012*^9, 3.613436251695031*^9, 3.613699032852221*^9, 
   3.6137000739572573`*^9, 3.613913329934135*^9, 3.6139211644432383`*^9, 
   3.614289776048626*^9, 3.615045382536487*^9, 3.6150867874611197`*^9, 
   3.615088730367077*^9, 3.615089069325182*^9, 3.615117796214798*^9, 
   3.61547705619781*^9, 3.615775443168846*^9, 3.6158384866818867`*^9, 
   3.6158522953849163`*^9, 3.616007737290127*^9, 3.617907086311778*^9, 
   3.617908814847932*^9, 3.617908882961569*^9, 3.617909858722218*^9, 
   3.619109477285598*^9, 3.6234205056396847`*^9, 3.623429491062416*^9, 
   3.6234305077233057`*^9, 3.623433482922448*^9, 3.623433572650155*^9, {
   3.623452253622682*^9, 3.623452292975308*^9}, 3.6234567519585114`*^9, 
   3.62345759720179*^9, 3.623457970903495*^9, 3.623510681837118*^9, 
   3.623605456673884*^9, 3.6247470446028757`*^9, 3.664825329005344*^9, 
   3.664825394758458*^9, {3.66482549579117*^9, 3.6648255065195923`*^9}, 
   3.6648255441401043`*^9, {3.664825588907996*^9, 3.66482561587079*^9}, 
   3.664825796757291*^9, {3.6648258640924807`*^9, 3.664825884173077*^9}, 
   3.664826187022998*^9, 3.664826511023731*^9, 3.664826688434367*^9, 
   3.664826823515493*^9, 3.6648269158324537`*^9, 3.664877019861074*^9, 
   3.664887395328328*^9, 3.6653583460476217`*^9, 3.665439697410212*^9, 
   3.6654434418350782`*^9, {3.6654440606075*^9, 3.665444082545102*^9}, 
   3.665444935762998*^9, 3.665445392480155*^9, 3.6654961947944593`*^9, 
   3.6654963834512672`*^9, 3.6654973598707848`*^9, {3.665497732576871*^9, 
   3.6654977443613577`*^9}, 3.665497953377412*^9, 3.665498908997188*^9, 
   3.665498950542206*^9, 3.665499002230302*^9, 3.665499266672222*^9, 
   3.665499535474121*^9, {3.665499568454471*^9, 3.665499582351803*^9}, 
   3.6654997886561537`*^9, 3.665500136215979*^9, {3.666015716931199*^9, 
   3.666015722904353*^9}, 3.666016187025942*^9, 3.666016249588983*^9, {
   3.66601632813623*^9, 3.666016336781468*^9}, 3.6660165616981573`*^9, {
   3.666016656308172*^9, 3.666016685299205*^9}, 3.666016728492584*^9, {
   3.666016792192339*^9, 3.666016837429551*^9}, 3.6660172647576923`*^9, 
   3.666017316131689*^9, 3.666017560219376*^9, 3.666017815107621*^9, {
   3.666018553077723*^9, 3.666018581643537*^9}, 3.666019783015769*^9, 
   3.666019835086779*^9, {3.666019922114092*^9, 3.666019934416548*^9}, 
   3.6660200071691713`*^9, {3.666020060627389*^9, 3.666020065381884*^9}, 
   3.666020119308031*^9, {3.666020152989551*^9, 3.66602017929902*^9}, 
   3.666020763253985*^9, {3.66602079975984*^9, 3.666020802920162*^9}, 
   3.666020874659059*^9, 3.6660209760920753`*^9, 3.6660210253193274`*^9, 
   3.666021298719104*^9, 3.666027394565832*^9, {3.666027451206373*^9, 
   3.666027457503265*^9}, 3.6660285131410027`*^9, 3.6660285644812*^9, {
   3.666028979644044*^9, 3.6660290212153*^9}, {3.666029099331403*^9, 
   3.666029117551256*^9}, {3.666029871695498*^9, 3.666029891258871*^9}, 
   3.666444703479611*^9, 3.666444847981908*^9, 3.66644488326353*^9, {
   3.666444966109524*^9, 3.666444976591839*^9}}]
}, Open  ]],

Cell[BoxData[{
 RowBox[{
  RowBox[{"Needs", "[", "\"\<Quaternions`\>\"", "]"}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"Needs", "[", "\"\<Units`\>\"", "]"}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"Needs", "[", "\"\<RobotLinks`\>\"", "]"}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"Needs", "[", "\"\<ExtraUtil`\>\"", "]"}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"Needs", "[", "\"\<AmberShared`\>\"", "]"}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"Needs", "[", "\"\<CseOptimization`\>\"", "]"}], ";"}]}], "Input",
 CellChangeTimes->{{3.603297599328364*^9, 3.603297643709798*^9}, {
   3.6033039264136343`*^9, 3.6033039302836*^9}, {3.605741706977704*^9, 
   3.6057417086125937`*^9}, {3.612147589945771*^9, 3.6121475935023746`*^9}, {
   3.612158049488866*^9, 3.6121580631573143`*^9}, {3.664824344863595*^9, 
   3.664824414779131*^9}, {3.664825892934361*^9, 3.6648259313648767`*^9}, {
   3.6648259642731733`*^9, 3.664825989506673*^9}, {3.664826487171324*^9, 
   3.6648264953440857`*^9}, {3.664877057825838*^9, 3.6648770580345*^9}, 
   3.664887431984527*^9, {3.66488751340546*^9, 3.664887527479088*^9}, {
   3.665442897035759*^9, 3.66544292131822*^9}, {3.665443192496966*^9, 
   3.6654432314724092`*^9}, {3.665443393751857*^9, 3.665443399855073*^9}, {
   3.6654434344370213`*^9, 3.6654434367414513`*^9}, {3.665443571309701*^9, 
   3.665443571729134*^9}, {3.665444210853035*^9, 3.665444276489237*^9}, 
   3.665444420258082*^9, {3.665444879848032*^9, 3.665444880196085*^9}, {
   3.665444916798678*^9, 3.6654449268016443`*^9}, {3.6654452854646873`*^9, 
   3.6654452856402483`*^9}, {3.665445573003628*^9, 3.665445573414609*^9}, {
   3.6654961835987167`*^9, 3.665496191673437*^9}, {3.6654962985531054`*^9, 
   3.6654963019816008`*^9}, {3.665497437707849*^9, 3.6654974379447517`*^9}, {
   3.6654975273518667`*^9, 3.665497562992536*^9}, {3.6654979935712147`*^9, 
   3.665497993913389*^9}, {3.665498832043247*^9, 3.665498837372182*^9}, {
   3.6654988974503403`*^9, 3.665498897789513*^9}, {3.665498976419662*^9, 
   3.6654989766303587`*^9}, {3.6654994876260767`*^9, 3.6654994879488363`*^9}}],

Cell[BoxData[
 RowBox[{
  RowBox[{"builddir", "=", 
   RowBox[{"FileNameJoin", "[", 
    RowBox[{"{", 
     RowBox[{
      RowBox[{"ParentDirectory", "[", "]"}], ",", "\"\<gen\>\""}], "}"}], 
    "]"}]}], ";", 
  RowBox[{"If", "[", 
   RowBox[{
    RowBox[{"DirectoryQ", "[", "builddir", "]"}], ",", ",", 
    RowBox[{"CreateDirectory", "[", "builddir", "]"}]}], "]"}], 
  ";"}]], "Input",
 CellChangeTimes->{{3.6121476760499687`*^9, 3.612147693870275*^9}, 
   3.612158535777779*^9, 3.612158601281986*^9, 3.612165781548361*^9, {
   3.61222500668576*^9, 3.612225006902609*^9}, {3.66482535464811*^9, 
   3.6648253859854727`*^9}, {3.665497624249669*^9, 3.665497637318994*^9}, {
   3.66601622024384*^9, 3.6660162216629887`*^9}}],

Cell[CellGroupData[{

Cell[BoxData["builddir"], "Input",
 CellChangeTimes->{{3.664825387510263*^9, 3.664825388658701*^9}}],

Cell[BoxData["\<\"/home/jreher/test_ws/src/ros_imu/imu_common/gen\"\>"], \
"Output",
 CellChangeTimes->{{3.664825389128509*^9, 3.664825394793356*^9}, 
   3.664825506659645*^9, 3.664825546999639*^9, {3.664825591401167*^9, 
   3.6648256161535683`*^9}, 3.664825808649446*^9, {3.6648258642943296`*^9, 
   3.664825886759083*^9}, 3.664826187047287*^9, 3.664826511059046*^9, 
   3.66482668851857*^9, 3.664826823565325*^9, 3.664826915900906*^9, 
   3.6648770201376247`*^9, 3.66488739552413*^9, 3.665358346255835*^9, 
   3.665439697542577*^9, 3.6654434419758472`*^9, 3.665445392586604*^9, 
   3.665496383800665*^9, 3.665497360163278*^9, 3.665497644032936*^9, {
   3.66549773261027*^9, 3.6654977446725063`*^9}, 3.665499002418457*^9, 
   3.665499266722838*^9, 3.665499788757661*^9, 3.6655001362650967`*^9, {
   3.666015717384323*^9, 3.666015723030837*^9}, {3.66601619374925*^9, 
   3.666016227275395*^9}, {3.66601632820092*^9, 3.666016336879825*^9}, 
   3.66601656177033*^9, {3.666016656382329*^9, 3.666016685399807*^9}, 
   3.666016728547325*^9, {3.666016792250552*^9, 3.666016837500802*^9}, 
   3.666017264849267*^9, 3.666017316179613*^9, 3.6660175604386263`*^9, 
   3.666017815225456*^9, {3.6660185531424828`*^9, 3.666018581696249*^9}, 
   3.666019783215899*^9, 3.666019835144669*^9, {3.6660199221731033`*^9, 
   3.666019934467453*^9}, 3.666020007372061*^9, {3.666020061108889*^9, 
   3.666020065615415*^9}, 3.666020119767907*^9, {3.666020153258429*^9, 
   3.6660201795172*^9}, 3.666020763516033*^9, {3.666020799811747*^9, 
   3.666020802984612*^9}, 3.666020874714614*^9, 3.666020976142886*^9, 
   3.666021025730259*^9, 3.666021298961671*^9, 3.666027394760625*^9, {
   3.6660274516917143`*^9, 3.666027457731565*^9}, 3.666028513613882*^9, 
   3.666028564957655*^9, {3.666028979708338*^9, 3.666029021312978*^9}, {
   3.666029099404269*^9, 3.666029117611171*^9}, {3.666029871756673*^9, 
   3.666029891301985*^9}, 3.6664447040261497`*^9, 3.6664448482120247`*^9, 
   3.666444883470399*^9, {3.666444966333734*^9, 3.6664449767646713`*^9}}]
}, Open  ]],

Cell[BoxData[
 RowBox[{
  RowBox[{"On", "[", "Assert", "]"}], ";"}]], "Input",
 CellChangeTimes->{{3.664824358394725*^9, 3.6648243612715282`*^9}, {
  3.66549926483959*^9, 3.665499265017482*^9}}],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"Q", "[", "a_", "]"}], ":=", 
   RowBox[{"Table", "[", 
    RowBox[{
     RowBox[{"a", "\[LeftDoubleBracket]", "i", "\[RightDoubleBracket]"}], ",", 
     RowBox[{"{", 
      RowBox[{"i", ",", "1", ",", "4"}], "}"}]}], "]"}]}], ";"}]], "Input",
 CellChangeTimes->{{3.664820338149074*^9, 3.664820375677182*^9}, {
  3.664820681563223*^9, 3.6648207676525183`*^9}, {3.6648208353590193`*^9, 
  3.664820905688328*^9}}]
}, Open  ]],

Cell[CellGroupData[{

Cell["Variables", "Section",
 CellChangeTimes->{{3.664822045875762*^9, 3.6648220469220963`*^9}}],

Cell[CellGroupData[{

Cell["Human", "Subsection",
 CellChangeTimes->{{3.664822674688484*^9, 3.664822675338833*^9}}],

Cell["Measurements are for (5\[CloseCurlyQuote]11\[CloseCurlyDoubleQuote]) \
person", "Text",
 CellChangeTimes->{{3.6648239027216463`*^9, 3.664823923175663*^9}}],

Cell[BoxData[
 RowBox[{
  RowBox[{"r", "=", 
   RowBox[{"{", 
    RowBox[{
     SubscriptBox["rad", "1"], ",", 
     SubscriptBox["rad", "2"], ",", 
     SubscriptBox["rad", "3"]}], "}"}]}], ";"}]], "Input",
 CellChangeTimes->{{3.665442778876341*^9, 3.6654428099191093`*^9}, {
  3.6660185364751663`*^9, 3.666018544082893*^9}}],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   SubscriptBox["r", "foot"], "=", 
   RowBox[{"{", 
    RowBox[{"0.1016", ",", "0", ",", 
     RowBox[{"-", "0.0254"}]}], "}"}]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   SubscriptBox["r", "shank"], "=", 
   RowBox[{"{", 
    RowBox[{"0.0508", ",", "0", ",", 
     RowBox[{"-", "0.3556"}]}], "}"}]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   SubscriptBox["r", "thigh"], "=", 
   RowBox[{"{", 
    RowBox[{"0.0762", ",", "0", ",", 
     RowBox[{"-", "0.3048"}]}], "}"}]}], ";"}]}], "Input",
 CellChangeTimes->{{3.6648227035193243`*^9, 3.664822732903714*^9}, {
  3.66482392853622*^9, 3.664824010498671*^9}}],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   SubscriptBox["l", "shank"], "=", 
   RowBox[{"{", 
    RowBox[{"0", ",", "0", ",", 
     RowBox[{"-", "0.4318"}]}], "}"}]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   SubscriptBox["l", "thigh"], "=", 
   RowBox[{"{", 
    RowBox[{"0", ",", "0", ",", 
     RowBox[{"-", "0.4318"}]}], "}"}]}], ";"}]}], "Input",
 CellChangeTimes->{{3.664823866099413*^9, 3.664823898622179*^9}, {
  3.664824019142407*^9, 3.664824040884757*^9}}],

Cell[BoxData[
 RowBox[{
  RowBox[{"g", "=", "9.81"}], ";"}]], "Input",
 CellChangeTimes->{{3.6660165571554937`*^9, 3.666016560722768*^9}}]
}, Open  ]],

Cell[CellGroupData[{

Cell["Model", "Subsection",
 CellChangeTimes->{{3.6648222747467813`*^9, 3.664822276035839*^9}}],

Cell[BoxData[{
 RowBox[{
  RowBox[{"q", "=", 
   RowBox[{"Quaternion", "[", 
    RowBox[{
     RowBox[{"q0", "[", "t", "]"}], ",", 
     RowBox[{"q1", "[", "t", "]"}], ",", 
     RowBox[{"q2", "[", "t", "]"}], ",", 
     RowBox[{"q3", "[", "t", "]"}]}], "]"}]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"dq", "=", 
   RowBox[{"Quaternion", "[", 
    RowBox[{
     RowBox[{"dq0", "[", "t", "]"}], ",", 
     RowBox[{"dq1", "[", "t", "]"}], ",", 
     RowBox[{"dq2", "[", "t", "]"}], ",", 
     RowBox[{"dq3", "[", "t", "]"}]}], "]"}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"ddq", "=", 
   RowBox[{"Quaternion", "[", 
    RowBox[{
     RowBox[{"ddq0", "[", "t", "]"}], ",", 
     RowBox[{"ddq1", "[", "t", "]"}], ",", 
     RowBox[{"ddq2", "[", "t", "]"}], ",", 
     RowBox[{"ddq3", "[", "t", "]"}]}], "]"}]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"w", "=", 
   RowBox[{"{", 
    RowBox[{
     RowBox[{
      SubscriptBox["\[Omega]", "1"], "[", "t", "]"}], ",", 
     RowBox[{
      SubscriptBox["\[Omega]", "2"], "[", "t", "]"}], ",", 
     RowBox[{
      SubscriptBox["\[Omega]", "3"], "[", "t", "]"}]}], "}"}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"dw", "=", 
   RowBox[{"D", "[", 
    RowBox[{"w", ",", "t"}], "]"}]}], ";"}]}], "Input",
 CellChangeTimes->{{3.6648171298863277`*^9, 3.664817212358054*^9}, {
   3.664817252606267*^9, 3.664817266354185*^9}, {3.664817382974412*^9, 
   3.664817387485642*^9}, {3.664817703296897*^9, 3.664817706386367*^9}, {
   3.6648199392822647`*^9, 3.664820111383453*^9}, {3.664820149981251*^9, 
   3.6648201572519007`*^9}, {3.664821173781633*^9, 3.664821174778947*^9}, {
   3.664821842373855*^9, 3.6648218434495897`*^9}, 3.666017360780098*^9}],

Cell[BoxData[{
 RowBox[{
  RowBox[{"qw", "=", 
   RowBox[{"Quaternion", "[", 
    RowBox[{"0", ",", 
     RowBox[{
      SubscriptBox["\[Omega]", "1"], "[", "t", "]"}], ",", 
     RowBox[{
      SubscriptBox["\[Omega]", "2"], "[", "t", "]"}], ",", 
     RowBox[{
      SubscriptBox["\[Omega]", "3"], "[", "t", "]"}]}], "]"}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"dqw", "=", 
   RowBox[{"Quaternion", "[", 
    RowBox[{"0", ",", 
     RowBox[{
      RowBox[{
       SubscriptBox["\[Omega]", "1"], "'"}], "[", "t", "]"}], ",", 
     RowBox[{
      RowBox[{
       SubscriptBox["\[Omega]", "2"], "'"}], "[", "t", "]"}], ",", 
     RowBox[{
      RowBox[{
       SubscriptBox["\[Omega]", "3"], "'"}], "[", "t", "]"}]}], "]"}]}], 
  ";"}]}], "Input",
 CellChangeTimes->{{3.6648211771789513`*^9, 3.664821204532753*^9}, {
   3.664821724136841*^9, 3.664821851684708*^9}, 3.664821918120741*^9}],

Cell[CellGroupData[{

Cell[BoxData[{
 RowBox[{
  RowBox[{"\[ScriptCapitalX]", "=", 
   RowBox[{"Flatten", "[", 
    RowBox[{"{", 
     RowBox[{"w", ",", "dw", ",", 
      RowBox[{"Q", "[", "q", "]"}], ",", 
      RowBox[{"Q", "[", "dq", "]"}], ",", 
      RowBox[{"Q", "[", "ddq", "]"}]}], "}"}], "]"}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{"Dimensions", "[", "\[ScriptCapitalX]", "]"}]}], "Input",
 CellChangeTimes->{{3.664816914852178*^9, 3.66481698336904*^9}, {
  3.6648172685303593`*^9, 3.6648172776033897`*^9}, {3.664819973628085*^9, 
  3.66482000462833*^9}, {3.66482012735417*^9, 3.664820131265975*^9}, {
  3.6648209089340343`*^9, 3.6648209493234386`*^9}, {3.66482604798845*^9, 
  3.6648260495253696`*^9}, {3.665439691743513*^9, 3.665439695941333*^9}}],

Cell[BoxData[
 RowBox[{"{", "18", "}"}]], "Output",
 CellChangeTimes->{{3.6654396964981623`*^9, 3.6654396983430862`*^9}, 
   3.665443442076686*^9, 3.6654453926390133`*^9, 3.665496383844593*^9, 
   3.665497360208171*^9, {3.665497732651067*^9, 3.665497744777341*^9}, 
   3.665499002865921*^9, 3.665499266766574*^9, 3.66549978888446*^9, 
   3.665500136399609*^9, {3.6660157175494223`*^9, 3.666015723125741*^9}, 
   3.666016257794425*^9, {3.666016328341753*^9, 3.6660163370146093`*^9}, 
   3.666016561862759*^9, {3.666016656511756*^9, 3.6660166854613047`*^9}, 
   3.6660167286289263`*^9, {3.6660167923495913`*^9, 3.6660168375605383`*^9}, 
   3.666017264919304*^9, 3.666017316311542*^9, 3.666017561031576*^9, 
   3.666017815274881*^9, {3.666018553230856*^9, 3.6660185817786417`*^9}, 
   3.6660197838013144`*^9, 3.6660198352568283`*^9, {3.66601992224621*^9, 
   3.666019934523452*^9}, 3.6660200079460793`*^9, {3.6660200617684517`*^9, 
   3.666020066183948*^9}, 3.666020120435791*^9, {3.666020153896092*^9, 
   3.6660201800862083`*^9}, 3.6660207641201687`*^9, 3.666020803070109*^9, 
   3.66602087478568*^9, 3.666020976238162*^9, 3.66602102579321*^9, 
   3.666021299515483*^9, 3.666027395311529*^9, {3.666027452345914*^9, 
   3.6660274583356028`*^9}, 3.666028514286428*^9, 3.66602856565874*^9, {
   3.6660289798217497`*^9, 3.66602902137202*^9}, {3.666029099473781*^9, 
   3.6660291177041073`*^9}, {3.6660298718491573`*^9, 3.666029891348896*^9}, 
   3.666444704694471*^9, 3.666444848807267*^9, 3.6664448840644293`*^9, {
   3.666444966919334*^9, 3.666444977316234*^9}}]
}, Open  ]]
}, Open  ]],

Cell[CellGroupData[{

Cell["Measurement", "Subsection",
 CellChangeTimes->{{3.664822280543563*^9, 3.664822281626108*^9}}],

Cell[BoxData[{
 RowBox[{
  RowBox[{"a0", "=", 
   RowBox[{"{", 
    RowBox[{
     SubscriptBox["a", "1"], ",", 
     SubscriptBox["a", "2"], ",", 
     SubscriptBox["a", "3"]}], "}"}]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"Bm", "=", 
   RowBox[{"{", 
    RowBox[{
     SubscriptBox["B", "1"], ",", 
     SubscriptBox["B", "2"], ",", 
     SubscriptBox["B", "3"]}], "}"}]}], ";"}]}], "Input",
 CellChangeTimes->{{3.6648223221757174`*^9, 3.6648223573806267`*^9}, {
  3.6664448135218277`*^9, 3.666444829286948*^9}}],

Cell[BoxData[
 RowBox[{
  RowBox[{"qB", "=", 
   RowBox[{"Quaternion", "[", 
    RowBox[{"0", ",", 
     SubscriptBox["B", "1"], ",", 
     SubscriptBox["B", "2"], ",", 
     SubscriptBox["B", "3"]}], "]"}]}], ";"}]], "Input",
 CellChangeTimes->{{3.6648223859145527`*^9, 3.664822399760791*^9}, {
  3.666444835777256*^9, 3.6664448814944353`*^9}}],

Cell[CellGroupData[{

Cell[BoxData[{
 RowBox[{
  RowBox[{"\[ScriptCapitalZ]", "=", 
   RowBox[{"Flatten", "[", 
    RowBox[{"{", 
     RowBox[{"w", ",", "dw", ",", 
      RowBox[{"Q", "[", "q", "]"}], ",", "a0", ",", "Bm"}], "}"}], "]"}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{"Dimensions", "[", "\[ScriptCapitalZ]", "]"}]}], "Input",
 CellChangeTimes->{{3.664822283286623*^9, 3.664822316773469*^9}, {
  3.6648223490483437`*^9, 3.664822379408214*^9}, {3.664826057950521*^9, 
  3.664826059603712*^9}, {3.665439769827652*^9, 3.665439773733389*^9}}],

Cell[BoxData[
 RowBox[{"{", "16", "}"}]], "Output",
 CellChangeTimes->{
  3.665439774353703*^9, 3.665443442110565*^9, 3.665445392733358*^9, 
   3.665496383873726*^9, 3.665497360282753*^9, {3.665497732671822*^9, 
   3.665497744810535*^9}, 3.6654990030395603`*^9, 3.665499266792*^9, 
   3.665499788907477*^9, 3.665500136427601*^9, {3.666015717589101*^9, 
   3.666015723166533*^9}, 3.666016257827866*^9, {3.666016328379057*^9, 
   3.666016337047722*^9}, 3.666016561902162*^9, {3.666016656554819*^9, 
   3.666016685495764*^9}, 3.666016728647361*^9, {3.666016792383237*^9, 
   3.666016837593741*^9}, 3.6660172649531193`*^9, 3.6660173163387814`*^9, 
   3.666017561278973*^9, 3.6660178153017*^9, {3.666018553271131*^9, 
   3.666018581809663*^9}, 3.6660197840416822`*^9, 3.666019835286326*^9, {
   3.666019922281324*^9, 3.666019934548563*^9}, 3.666020008182139*^9, {
   3.666020061949028*^9, 3.666020066432933*^9}, 3.666020120626437*^9, {
   3.666020154088262*^9, 3.666020180334051*^9}, 3.666020764366846*^9, 
   3.666020803109414*^9, 3.666020874819084*^9, 3.6660209762700453`*^9, 
   3.666021025827629*^9, 3.666021299753667*^9, 3.666027395490683*^9, {
   3.666027452525094*^9, 3.6660274585771017`*^9}, 3.66602851447073*^9, 
   3.666028565837599*^9, {3.6660289798509407`*^9, 3.666029021405171*^9}, {
   3.6660290995035257`*^9, 3.666029117732592*^9}, {3.666029871883522*^9, 
   3.6660298913742943`*^9}, 3.666444704884737*^9, 3.6664448490595083`*^9, 
   3.666444884317987*^9, {3.6664449671736727`*^9, 3.6664449774916277`*^9}}]
}, Open  ]]
}, Open  ]]
}, Open  ]],

Cell[CellGroupData[{

Cell["Process Function", "Section",
 CellChangeTimes->{{3.664822062077786*^9, 3.6648220645764303`*^9}}],

Cell[BoxData[{
 RowBox[{
  RowBox[{"fw", "=", 
   RowBox[{"w", "+", 
    RowBox[{"dw", " ", "dt"}]}]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"fdw", "=", "dw"}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"fq", "=", 
   RowBox[{
    RowBox[{"Q", "[", "q", "]"}], "+", 
    RowBox[{
     RowBox[{"Q", "[", "dq", "]"}], " ", "dt"}]}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"fdq", "=", 
   RowBox[{
    FractionBox["1", "2"], 
    RowBox[{"Q", "[", 
     RowBox[{"q", "**", "qw"}], "]"}]}]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"fddq", "=", 
   RowBox[{
    RowBox[{
     FractionBox["1", "2"], 
     RowBox[{"Q", "[", 
      RowBox[{"q", "**", "qw"}], "]"}]}], "+", 
    RowBox[{
     FractionBox["1", "2"], 
     RowBox[{"Q", "[", 
      RowBox[{"q", "**", "dqw"}], "]"}]}]}]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"fvec", "=", 
   RowBox[{"Flatten", "[", 
    RowBox[{"{", 
     RowBox[{"fw", ",", "fdw", ",", "fq", ",", "fdq", ",", "fddq"}], "}"}], 
    "]"}]}], ";"}]}], "Input",
 CellChangeTimes->{{3.664820951327874*^9, 3.664821033384265*^9}, {
  3.664821084835493*^9, 3.664821155721685*^9}, {3.6648212092086983`*^9, 
  3.6648212142290287`*^9}, {3.6648216785479383`*^9, 3.6648217112181387`*^9}, {
  3.664821854639525*^9, 3.6648218705821342`*^9}, {3.664821927273411*^9, 
  3.664821985886545*^9}}],

Cell[BoxData[
 RowBox[{
  RowBox[{"\[ScriptCapitalA]", "=", 
   RowBox[{"D", "[", 
    RowBox[{"fvec", ",", 
     RowBox[{"{", "\[ScriptCapitalX]", "}"}]}], "]"}]}], ";"}]], "Input",
 CellChangeTimes->{{3.6648219874638023`*^9, 3.664822013964324*^9}, {
  3.664822592163403*^9, 3.664822596847081*^9}, {3.6648260711332808`*^9, 
  3.664826072382489*^9}}]
}, Open  ]],

Cell[CellGroupData[{

Cell["Measurement Function", "Section",
 CellChangeTimes->{{3.6648220736206293`*^9, 3.6648220765321207`*^9}}],

Cell[BoxData[{
 RowBox[{
  RowBox[{"hw", "=", "w"}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"hdw", "=", "dw"}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"hq", "=", 
   RowBox[{"Q", "[", "q", "]"}]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"ha", "=", 
   RowBox[{"a0", "+", 
    RowBox[{"Cross", "[", 
     RowBox[{"w", ",", 
      RowBox[{"Cross", "[", 
       RowBox[{"w", ",", "r"}], "]"}]}], "]"}], "+", 
    RowBox[{"Cross", "[", 
     RowBox[{"dw", ",", "r"}], "]"}], "-", 
    RowBox[{"{", 
     RowBox[{"0", ",", "0", ",", "g"}], "}"}]}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"hB", "=", 
   RowBox[{
    RowBox[{"Q", "[", 
     RowBox[{
      RowBox[{"Conjugate", "[", "q", "]"}], "**", "qB", "**", "q"}], "]"}], 
    "\[LeftDoubleBracket]", 
    RowBox[{"2", ";;", "4"}], "\[RightDoubleBracket]"}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"hvec", "=", 
   RowBox[{"Flatten", "[", 
    RowBox[{"{", 
     RowBox[{"hw", ",", "hdw", ",", "hq", ",", "ha", ",", "hB"}], "}"}], 
    "]"}]}], ";"}]}], "Input",
 CellChangeTimes->{{3.66482221955155*^9, 3.6648222454007397`*^9}, {
  3.664822405667283*^9, 3.664822551993037*^9}, {3.664822662358261*^9, 
  3.664822665037881*^9}, {3.66601846841227*^9, 3.666018469936324*^9}}],

Cell[BoxData[
 RowBox[{
  RowBox[{"\[ScriptCapitalH]", "=", 
   RowBox[{"D", "[", 
    RowBox[{
     RowBox[{"Flatten", "[", "hvec", "]"}], ",", 
     RowBox[{"{", "\[ScriptCapitalX]", "}"}]}], "]"}]}], ";"}]], "Input",
 CellChangeTimes->{{3.664822583019367*^9, 3.664822624939521*^9}, {
  3.664822769394586*^9, 3.664822806418232*^9}, {3.664822852705125*^9, 
  3.664822909006754*^9}, {3.6648229432403717`*^9, 3.664822947061935*^9}, {
  3.6648260823679523`*^9, 3.6648260835433292`*^9}, {3.666018482600275*^9, 
  3.666018502637093*^9}}]
}, Open  ]],

Cell[CellGroupData[{

Cell["Link Dynamics", "Section",
 CellChangeTimes->{{3.664824086802828*^9, 3.664824089337219*^9}}],

Cell[BoxData[
 RowBox[{
  RowBox[{"af", "=", 
   RowBox[{"a0", "+", 
    RowBox[{"Cross", "[", 
     RowBox[{"w", ",", 
      RowBox[{"Cross", "[", 
       RowBox[{"w", ",", "r"}], "]"}]}], "]"}], "+", 
    RowBox[{"Cross", "[", 
     RowBox[{"dw", ",", "r"}], "]"}], "-", 
    RowBox[{"{", 
     RowBox[{"0", ",", "0", ",", "g"}], "}"}]}]}], ";"}]], "Input",
 CellChangeTimes->{{3.6648240915608797`*^9, 3.664824097382213*^9}, {
  3.664824164611611*^9, 3.664824171372661*^9}, {3.666016593825267*^9, 
  3.666016652966565*^9}, {3.666016743271896*^9, 3.666016748418148*^9}, {
  3.666018508669004*^9, 3.666018528395309*^9}}],

Cell[CellGroupData[{

Cell[BoxData[
 RowBox[{
  RowBox[{"af", "/.", 
   RowBox[{"{", 
    RowBox[{
     RowBox[{
      SubscriptBox["rad", "1"], "\[Rule]", "0"}], ",", 
     RowBox[{
      SubscriptBox["rad", "2"], "\[Rule]", "0"}], ",", 
     RowBox[{
      SubscriptBox["rad", "3"], "\[Rule]", "0"}]}], "}"}]}], "//", 
  "MatrixForm"}]], "Input",
 CellChangeTimes->{{3.666444702018816*^9, 3.666444731154564*^9}}],

Cell[BoxData[
 TagBox[
  RowBox[{"(", "\[NoBreak]", 
   TagBox[GridBox[{
      {
       SubscriptBox["a", "1"]},
      {
       SubscriptBox["a", "2"]},
      {
       RowBox[{
        RowBox[{"-", "9.81`"}], "+", 
        SubscriptBox["a", "3"]}]}
     },
     GridBoxAlignment->{
      "Columns" -> {{Center}}, "ColumnsIndexed" -> {}, "Rows" -> {{Baseline}},
        "RowsIndexed" -> {}},
     GridBoxSpacings->{"Columns" -> {
         Offset[0.27999999999999997`], {
          Offset[0.5599999999999999]}, 
         Offset[0.27999999999999997`]}, "ColumnsIndexed" -> {}, "Rows" -> {
         Offset[0.2], {
          Offset[0.4]}, 
         Offset[0.2]}, "RowsIndexed" -> {}}],
    Column], "\[NoBreak]", ")"}],
  Function[BoxForm`e$, 
   MatrixForm[BoxForm`e$]]]], "Output",
 CellChangeTimes->{{3.666444705362918*^9, 3.666444731547606*^9}, 
   3.666444849617885*^9, 3.66644488474935*^9, {3.666444967607127*^9, 
   3.666444977946576*^9}}]
}, Open  ]]
}, Open  ]],

Cell[CellGroupData[{

Cell["Save Functions", "Section",
 CellChangeTimes->{{3.664824070774461*^9, 3.6648240731586227`*^9}}],

Cell[BoxData[{
 RowBox[{
  RowBox[{"modsubs", "=", 
   RowBox[{"Join", "[", 
    RowBox[{
     RowBox[{"(", 
      RowBox[{
       RowBox[{"(", 
        RowBox[{
         RowBox[{
          RowBox[{"\[ScriptCapitalX]", "[", 
           RowBox[{"[", 
            RowBox[{"#", "+", "1"}], "]"}], "]"}], "->", " ", 
          RowBox[{"HoldForm", "@", 
           RowBox[{"x", "[", 
            RowBox[{"[", "#", "]"}], "]"}]}]}], "&"}], ")"}], "/@", 
       RowBox[{"(", 
        RowBox[{
         RowBox[{"Range", "[", "18", "]"}], "-", "1"}], ")"}]}], ")"}], ",", 
     RowBox[{"(", 
      RowBox[{
       RowBox[{"(", 
        RowBox[{
         RowBox[{"dt", "->", " ", 
          RowBox[{"HoldForm", "@", 
           RowBox[{"dt", "[", 
            RowBox[{"[", "#", "]"}], "]"}]}]}], "&"}], ")"}], "/@", 
       RowBox[{"(", 
        RowBox[{
         RowBox[{"Range", "[", "1", "]"}], "-", "1"}], ")"}]}], ")"}]}], 
    "]"}]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"meassubs", "=", 
   RowBox[{"Join", "[", 
    RowBox[{
     RowBox[{"(", 
      RowBox[{
       RowBox[{"(", 
        RowBox[{
         RowBox[{
          RowBox[{"\[ScriptCapitalZ]", "[", 
           RowBox[{"[", 
            RowBox[{"#", "+", "1"}], "]"}], "]"}], "->", " ", 
          RowBox[{"HoldForm", "@", 
           RowBox[{"x", "[", 
            RowBox[{"[", "#", "]"}], "]"}]}]}], "&"}], ")"}], "/@", 
       RowBox[{"(", 
        RowBox[{
         RowBox[{"Range", "[", "16", "]"}], "-", "1"}], ")"}]}], ")"}], ",", 
     RowBox[{"(", 
      RowBox[{
       RowBox[{"(", 
        RowBox[{
         RowBox[{
          RowBox[{"a0", "[", 
           RowBox[{"[", 
            RowBox[{"#", "+", "1"}], "]"}], "]"}], "->", " ", 
          RowBox[{"HoldForm", "@", 
           RowBox[{"a", "[", 
            RowBox[{"[", "#", "]"}], "]"}]}]}], "&"}], ")"}], "/@", 
       RowBox[{"(", 
        RowBox[{
         RowBox[{"Range", "[", "3", "]"}], "-", "1"}], ")"}]}], ")"}], ",", 
     RowBox[{"(", 
      RowBox[{
       RowBox[{"(", 
        RowBox[{
         RowBox[{
          RowBox[{"r", "[", 
           RowBox[{"[", 
            RowBox[{"#", "+", "1"}], "]"}], "]"}], "->", " ", 
          RowBox[{"HoldForm", "@", 
           RowBox[{"rad", "[", 
            RowBox[{"[", "#", "]"}], "]"}]}]}], "&"}], ")"}], "/@", 
       RowBox[{"(", 
        RowBox[{
         RowBox[{"Range", "[", "3", "]"}], "-", "1"}], ")"}]}], ")"}]}], 
    "]"}]}], ";"}]}], "Input",
 CellChangeTimes->{{3.6654999176874332`*^9, 3.665500025042975*^9}, {
   3.6660164636086683`*^9, 3.6660165099009867`*^9}, {3.666016834084626*^9, 
   3.6660168351576757`*^9}, {3.666017156281486*^9, 3.666017262676195*^9}, {
   3.66601857751712*^9, 3.666018579669401*^9}, {3.6660290871707993`*^9, 
   3.666029096907872*^9}, {3.666029839390778*^9, 3.6660298622684183`*^9}, 
   3.666444890775714*^9, {3.666444960574284*^9, 3.6664449702125893`*^9}}],

Cell[CellGroupData[{

Cell[BoxData[
 RowBox[{"SetDirectory", "[", 
  RowBox[{"NotebookDirectory", "[", "]"}], "]"}]], "Input",
 CellChangeTimes->{{3.6660162343911467`*^9, 3.666016236443853*^9}, 
   3.6660163084368887`*^9}],

Cell[BoxData["\<\"/home/jreher/test_ws/src/ros_imu/imu_common/mathematica\"\>\
"], "Output",
 CellChangeTimes->{
  3.665402098604764*^9, 3.665439698993745*^9, 3.665443442167783*^9, 
   3.665445392791387*^9, 3.665496384017688*^9, 3.665497360324471*^9, 
   3.665497685554966*^9, {3.665497732791381*^9, 3.665497744873369*^9}, 
   3.665499003548789*^9, 3.6654992668355293`*^9, 3.665499788953741*^9, 
   3.665500136508134*^9, {3.6660157177244883`*^9, 3.6660157232877073`*^9}, {
   3.6660162404743633`*^9, 3.666016262970883*^9}, {3.666016328473961*^9, 
   3.6660163371335506`*^9}, 3.666016561960149*^9, {3.666016656707745*^9, 
   3.6660166855806417`*^9}, 3.666016728682899*^9, {3.666016792452633*^9, 
   3.666016837728223*^9}, 3.6660172650149593`*^9, 3.66601731639996*^9, 
   3.666017562049638*^9, 3.6660178153492517`*^9, {3.666018553326914*^9, 
   3.666018581881094*^9}, 3.666019784505431*^9, 3.666019835347506*^9, {
   3.666019922350232*^9, 3.666019934655182*^9}, 3.666020008664969*^9, {
   3.666020062435145*^9, 3.666020066924149*^9}, 3.666020121102243*^9, {
   3.6660201545741453`*^9, 3.6660201808096*^9}, 3.6660207648420486`*^9, 
   3.666020803181918*^9, 3.6660208748789167`*^9, 3.6660209763248568`*^9, 
   3.666021025883891*^9, 3.6660213002316113`*^9, 3.666027396005802*^9, {
   3.666027453009383*^9, 3.66602745906549*^9}, 3.6660285152574778`*^9, 
   3.666028566296048*^9, {3.6660289799056797`*^9, 3.666029021469993*^9}, {
   3.666029099569469*^9, 3.6660291177840223`*^9}, {3.666029872098229*^9, 
   3.666029891632414*^9}, 3.6664447057599077`*^9, 3.666444849949252*^9, 
   3.6664448850392437`*^9, {3.666444967771605*^9, 3.666444978069503*^9}}]
}, Open  ]],

Cell[CellGroupData[{

Cell[BoxData[
 RowBox[{"xArg", "=", 
  RowBox[{"{", 
   RowBox[{"x", ",", 
    RowBox[{"Length", "[", "\[ScriptCapitalX]", "]"}]}], "}"}]}]], "Input",
 CellChangeTimes->{{3.6648262230092783`*^9, 3.6648262433482037`*^9}, {
  3.66549978402133*^9, 3.6654997852753887`*^9}}],

Cell[BoxData[
 RowBox[{"{", 
  RowBox[{"x", ",", "18"}], "}"}]], "Output",
 CellChangeTimes->{{3.6654997855554028`*^9, 3.665499788969833*^9}, 
   3.6655001365305758`*^9, {3.666015717748559*^9, 3.666015723320046*^9}, 
   3.666016266454589*^9, {3.6660163285051327`*^9, 3.6660163371634903`*^9}, 
   3.666016561985553*^9, {3.666016656742763*^9, 3.666016685609164*^9}, 
   3.666016728695713*^9, {3.666016792480907*^9, 3.66601683775517*^9}, 
   3.666017265043221*^9, 3.666017316423542*^9, 3.6660175621918373`*^9, 
   3.6660178153689632`*^9, {3.666018553354598*^9, 3.666018581905611*^9}, 
   3.666019784580366*^9, 3.666019835372225*^9, {3.666019922375894*^9, 
   3.666019934676647*^9}, 3.666020008742032*^9, {3.666020062510893*^9, 
   3.6660200670021763`*^9}, 3.666020121186397*^9, {3.666020154655335*^9, 
   3.666020180891354*^9}, 3.666020764921691*^9, 3.666020803208515*^9, 
   3.6660208749040194`*^9, 3.6660209763486757`*^9, 3.6660210259103823`*^9, 
   3.666021300307892*^9, 3.666027396078026*^9, {3.666027453082288*^9, 
   3.6660274591412983`*^9}, 3.6660285153253317`*^9, 3.666028566371324*^9, {
   3.666028979925272*^9, 3.6660290214960957`*^9}, {3.666029099591181*^9, 
   3.666029117804378*^9}, {3.666029872129952*^9, 3.666029891657607*^9}, 
   3.66644470583995*^9, 3.666444885113495*^9, {3.666444967857201*^9, 
   3.666444978136325*^9}}]
}, Open  ]],

Cell[BoxData[
 RowBox[{"(*", 
  RowBox[{
   RowBox[{"modexprs", "=", 
    RowBox[{
     RowBox[{"{", "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{
         RowBox[{"fvec", "//", "ParallelSimplify"}], ",", "\"\<fvec\>\""}], 
        "}"}], ",", "\[IndentingNewLine]", 
       RowBox[{"{", 
        RowBox[{
         RowBox[{"hvec", "//", "ParallelSimplify"}], ",", "\"\<hvec\>\""}], 
        "}"}], ",", "\[IndentingNewLine]", 
       RowBox[{"{", 
        RowBox[{
         RowBox[{"\[ScriptCapitalA]", "//", "ParallelSimplify"}], ",", 
         "\"\<Amat\>\""}], "}"}]}], "\[IndentingNewLine]", "}"}], "/.", 
     "modsubs"}]}], ";"}]}]], "Input",
 CellChangeTimes->{{3.664824892754221*^9, 3.664825013243081*^9}, {
   3.664825052060408*^9, 3.664825061910857*^9}, {3.6648252015628977`*^9, 
   3.664825231326171*^9}, 3.664826179411893*^9, {3.664826636231823*^9, 
   3.664826644851965*^9}, {3.6654969063422728`*^9, 3.665496909617639*^9}, {
   3.666016675392385*^9, 3.666016678505677*^9}},
 EmphasizeSyntaxErrors->True],

Cell[BoxData[
 RowBox[{"(*", 
  RowBox[{
   RowBox[{"measexprs", "=", 
    RowBox[{
     RowBox[{"{", "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{
         RowBox[{
          RowBox[{"\[ScriptCapitalH]", "[", "r", "]"}], "//", 
          "ParallelSimplify"}], ",", "\"\<Hmat_thigh\>\""}], "}"}], ",", 
       "\[IndentingNewLine]", 
       RowBox[{"{", 
        RowBox[{
         RowBox[{"af", "//", "ParallelSimplify"}], ",", "\"\<af\>\""}], 
        "}"}]}], "\[IndentingNewLine]", "}"}], "/.", "meassubs"}]}], 
   ";"}]}]], "Input",
 CellChangeTimes->{{3.6648252050873127`*^9, 3.664825228612935*^9}, {
  3.66482664963796*^9, 3.664826656401526*^9}, {3.664826686794516*^9, 
  3.66482668708497*^9}, {3.665442726064722*^9, 3.6654427290217457`*^9}, {
  3.66544286819456*^9, 3.6654428722724533`*^9}, {3.666016682507688*^9, 
  3.666016682653467*^9}},
 EmphasizeSyntaxErrors->True],

Cell[BoxData[
 RowBox[{
  RowBox[{"SetOptions", "[", 
   RowBox[{"CseWriteCpp", ",", "\[IndentingNewLine]", 
    RowBox[{"ArgumentLists", "\[Rule]", 
     RowBox[{"{", 
      RowBox[{"x", ",", "dt"}], "}"}]}], ",", "\[IndentingNewLine]", 
    RowBox[{"Directory", "\[Rule]", "builddir"}], ",", "\[IndentingNewLine]", 
    
    RowBox[{"ArgumentDimensions", "\[Rule]", 
     RowBox[{"{", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{
         RowBox[{"Length", "[", "\[ScriptCapitalX]", "]"}], ",", "1"}], "}"}],
        ",", 
       RowBox[{"{", 
        RowBox[{"1", ",", "1"}], "}"}]}], "}"}]}], ",", "\[IndentingNewLine]", 
    RowBox[{"SubstitutionRules", "\[Rule]", "modsubs"}], ",", 
    "\[IndentingNewLine]", 
    RowBox[{"Namespace", "\[Rule]", "\"\<model_ekf\>\""}]}], 
   "\[IndentingNewLine]", "]"}], ";"}]], "Input",
 CellChangeTimes->{{3.665499745974568*^9, 3.6654997812418423`*^9}, {
   3.665499816077128*^9, 3.665499872032887*^9}, {3.665500031042239*^9, 
   3.665500039180499*^9}, {3.6655001607376833`*^9, 3.66550018362429*^9}, {
   3.665500391042768*^9, 3.665500412499844*^9}, {3.6660163143986683`*^9, 
   3.6660163358365583`*^9}, {3.66601644068924*^9, 3.666016466414151*^9}, 
   3.666016529944215*^9, {3.6660177786088657`*^9, 3.6660178044288816`*^9}, {
   3.66602895584163*^9, 3.666028956520995*^9}, {3.666029002210968*^9, 
   3.666029019976252*^9}, 3.666029075067452*^9, {3.666029114190015*^9, 
   3.6660291157798*^9}}],

Cell[BoxData[{
 RowBox[{"CseWriteCpp", "[", 
  RowBox[{"\"\<fvec\>\"", ",", 
   RowBox[{"{", "fvec", "}"}]}], "]"}], "\[IndentingNewLine]", 
 RowBox[{"CseWriteCpp", "[", 
  RowBox[{"\"\<Amat\>\"", ",", 
   RowBox[{"{", "\[ScriptCapitalA]", "}"}]}], "]"}]}], "Input",
 CellChangeTimes->{{3.6655000551211643`*^9, 3.665500077225602*^9}, {
  3.665500196339576*^9, 3.665500197528517*^9}, {3.665500339918235*^9, 
  3.665500345869876*^9}, {3.666015668133099*^9, 3.666015713273313*^9}, {
  3.666028935168696*^9, 3.666028935887333*^9}}],

Cell[BoxData[
 RowBox[{
  RowBox[{"SetOptions", "[", 
   RowBox[{"CseWriteCpp", ",", "\[IndentingNewLine]", 
    RowBox[{"ArgumentLists", "\[Rule]", 
     RowBox[{"{", 
      RowBox[{"x", ",", "a", ",", "rad"}], "}"}]}], ",", 
    "\[IndentingNewLine]", 
    RowBox[{"Directory", "\[Rule]", "builddir"}], ",", "\[IndentingNewLine]", 
    
    RowBox[{"ArgumentDimensions", "\[Rule]", 
     RowBox[{"{", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{
         RowBox[{"Length", "[", "\[ScriptCapitalZ]", "]"}], ",", "1"}], "}"}],
        ",", 
       RowBox[{"{", 
        RowBox[{"3", ",", "1"}], "}"}], ",", 
       RowBox[{"{", 
        RowBox[{"3", ",", "1"}], "}"}]}], "}"}]}], ",", "\[IndentingNewLine]", 
    RowBox[{"SubstitutionRules", "\[Rule]", "meassubs"}], ",", 
    "\[IndentingNewLine]", 
    RowBox[{"Namespace", "\[Rule]", "\"\<model_ekf\>\""}]}], 
   "\[IndentingNewLine]", "]"}], ";"}]], "Input",
 CellChangeTimes->{{3.666016468954471*^9, 3.666016470363091*^9}, {
  3.666016517178073*^9, 3.666016517331976*^9}, {3.666016726729385*^9, 
  3.666016726879291*^9}, {3.6660178106731987`*^9, 3.666017810855743*^9}, {
  3.66602987894*^9, 3.666029886384078*^9}}],

Cell[BoxData[{
 RowBox[{"CseWriteCpp", "[", 
  RowBox[{"\"\<hvec\>\"", ",", 
   RowBox[{"{", "hvec", "}"}]}], "]"}], "\[IndentingNewLine]", 
 RowBox[{"CseWriteCpp", "[", 
  RowBox[{"\"\<Hmat\>\"", ",", 
   RowBox[{"{", "\[ScriptCapitalH]", "}"}]}], "]"}], "\[IndentingNewLine]", 
 RowBox[{"CseWriteCpp", "[", 
  RowBox[{"\"\<acc_link\>\"", ",", 
   RowBox[{"{", "af", "}"}]}], "]"}]}], "Input",
 CellChangeTimes->{{3.666016760081918*^9, 3.666016809929842*^9}, {
  3.666018560155541*^9, 3.666018562341971*^9}, {3.6660212959797287`*^9, 
  3.6660212965416727`*^9}, {3.666028939660016*^9, 3.666028940266026*^9}}]
}, Open  ]]
}, Open  ]]
},
WindowSize->{1920, 1056},
WindowMargins->{{0, Automatic}, {Automatic, 0}},
FrontEndVersion->"10.2 for Linux x86 (64-bit) (July 29, 2015)",
StyleDefinitions->"Default.nb"
]
(* End of Notebook Content *)

(* Internal cache information *)
(*CellTagsOutline
CellTagsIndex->{}
*)
(*CellTagsIndex
CellTagsIndex->{}
*)
(*NotebookFileOutline
Notebook[{
Cell[CellGroupData[{
Cell[580, 22, 118, 1, 93, "Title"],
Cell[CellGroupData[{
Cell[723, 27, 92, 1, 65, "Section"],
Cell[818, 30, 159, 3, 32, "Input"],
Cell[CellGroupData[{
Cell[1002, 37, 1163, 23, 77, "Input"],
Cell[2168, 62, 4120, 58, 32, "Output"],
Cell[6291, 122, 4127, 58, 32, "Output"]
}, Open  ]],
Cell[10433, 183, 2148, 37, 143, "Input"],
Cell[12584, 222, 724, 17, 32, "Input"],
Cell[CellGroupData[{
Cell[13333, 243, 100, 1, 32, "Input"],
Cell[13436, 246, 2024, 28, 32, "Output"]
}, Open  ]],
Cell[15475, 277, 194, 4, 32, "Input"],
Cell[15672, 283, 457, 11, 32, "Input"]
}, Open  ]],
Cell[CellGroupData[{
Cell[16166, 299, 96, 1, 65, "Section"],
Cell[CellGroupData[{
Cell[16287, 304, 93, 1, 44, "Subsection"],
Cell[16383, 307, 161, 2, 31, "Text"],
Cell[16547, 311, 326, 9, 32, "Input"],
Cell[16876, 322, 671, 20, 78, "Input"],
Cell[17550, 344, 476, 14, 56, "Input"],
Cell[18029, 360, 138, 3, 32, "Input"]
}, Open  ]],
Cell[CellGroupData[{
Cell[18204, 368, 95, 1, 44, "Subsection"],
Cell[18302, 371, 1739, 46, 121, "Input"],
Cell[20044, 419, 905, 27, 55, "Input"],
Cell[CellGroupData[{
Cell[20974, 450, 744, 15, 55, "Input"],
Cell[21721, 467, 1559, 22, 32, "Output"]
}, Open  ]]
}, Open  ]],
Cell[CellGroupData[{
Cell[23329, 495, 99, 1, 44, "Subsection"],
Cell[23431, 498, 528, 16, 55, "Input"],
Cell[23962, 516, 345, 9, 32, "Input"],
Cell[CellGroupData[{
Cell[24332, 529, 531, 11, 55, "Input"],
Cell[24866, 542, 1516, 22, 32, "Output"]
}, Open  ]]
}, Open  ]]
}, Open  ]],
Cell[CellGroupData[{
Cell[26443, 571, 103, 1, 65, "Section"],
Cell[26549, 574, 1369, 41, 196, "Input"],
Cell[27921, 617, 350, 8, 32, "Input"]
}, Open  ]],
Cell[CellGroupData[{
Cell[28308, 630, 109, 1, 65, "Section"],
Cell[28420, 633, 1290, 37, 143, "Input"],
Cell[29713, 672, 533, 11, 32, "Input"]
}, Open  ]],
Cell[CellGroupData[{
Cell[30283, 688, 98, 1, 65, "Section"],
Cell[30384, 691, 620, 15, 32, "Input"],
Cell[CellGroupData[{
Cell[31029, 710, 392, 12, 32, "Input"],
Cell[31424, 724, 941, 28, 80, "Output"]
}, Open  ]]
}, Open  ]],
Cell[CellGroupData[{
Cell[32414, 758, 101, 1, 65, "Section"],
Cell[32518, 761, 2900, 83, 55, "Input"],
Cell[CellGroupData[{
Cell[35443, 848, 200, 4, 32, "Input"],
Cell[35646, 854, 1643, 23, 32, "Output"]
}, Open  ]],
Cell[CellGroupData[{
Cell[37326, 882, 270, 6, 32, "Input"],
Cell[37599, 890, 1336, 20, 32, "Output"]
}, Open  ]],
Cell[38950, 913, 1047, 25, 121, "Input"],
Cell[40000, 940, 908, 23, 99, "Input"],
Cell[40911, 965, 1446, 30, 165, "Input"],
Cell[42360, 997, 527, 10, 55, "Input"],
Cell[42890, 1009, 1178, 28, 165, "Input"],
Cell[44071, 1039, 608, 12, 77, "Input"]
}, Open  ]]
}, Open  ]]
}
]
*)

(* End of internal cache information *)
